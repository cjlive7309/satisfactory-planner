<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Satisfactory Factory Planner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root{
  --bg:#0f172a;--panel:#020617;--line:#1e293b;
  --text:#e5e7eb;--muted:#94a3b8;
  --good:#22c55e;--warn:#eab308;--bad:#ef4444;
}
body{margin:0;font-family:Arial,sans-serif;background:var(--bg);color:var(--text);}
header{padding:1rem;background:var(--panel);font-size:1.25rem;font-weight:bold;}
table{width:100%;border-collapse:collapse;margin-top:1rem;}
th,td{padding:0.6rem;border-bottom:1px solid var(--line);text-align:left;}
th{color:var(--muted);}
select,input{
  background:var(--panel);color:var(--text);
  border:1px solid var(--line);border-radius:6px;padding:0.3rem;
}
.status-good{color:var(--good);}
.status-warn{color:var(--warn);}
.status-bad{color:var(--bad);}
.status-wait{color:#64748b;}
.note{font-size:0.7rem;color:var(--warn);}
</style>
</head>
<body>

<header>üè≠ Satisfactory Factory Planner</header>

<main style="padding:1rem;">
<table>
<thead>
<tr>
<th>Item</th>
<th>Recipe</th>
<th>Target/min</th>
<th>Purity</th>
<th>Miner Mk</th>
<th>Miners</th>
<th>Input Belt</th>
<th>Machines</th>
<th>Power</th>
<th>Output Belt</th>
<th>Efficiency</th>
<th>Status</th>
</tr>
</thead>
<tbody id="planner"></tbody>
</table>
</main>

<script>
/* ================= DATA ================= */

const belts=[
 {name:"Mk1",cap:60},{name:"Mk2",cap:120},{name:"Mk3",cap:270},
 {name:"Mk4",cap:480},{name:"Mk5",cap:780}
];

const minerMks=[
 {name:"Mk1",mult:1},
 {name:"Mk2",mult:2},
 {name:"Mk3",mult:4}
];

const purityRates={
 "Impure":60,
 "Normal":120,
 "Pure":240
};

const recipes={
 "Iron Plate":[
  {name:"Default",rate:20,power:4},
  {name:"Coated Iron Plate (Alt)",rate:37.5,power:15}
 ],
 "Iron Rod":[
  {name:"Default",rate:15,power:4},
  {name:"Steel Rod (Alt)",rate:48,power:15}
 ],
 "Screw":[
  {name:"Default",rate:40,power:4},
  {name:"Cast Screw (Alt)",rate:200,power:4}
 ],
 "Reinforced Iron Plate":[
  {name:"Default",rate:5,power:15},
  {name:"Bolted Iron Plate (Alt)",rate:15,power:15}
 ],
 "Modular Frame":[{name:"Default",rate:2,power:15}],
 "Heavy Modular Frame":[
  {name:"Default",rate:0.5,power:55},
  {name:"Encased Frame (Alt)",rate:1,power:55}
 ]
};

/* ================= HELPERS ================= */

const bestRecipe=list=>list.reduce((a,b)=>b.rate>a.rate?b:a);
const beltFor=r=>belts.find(b=>r<=b.cap)||belts.at(-1);
const effLabel=e=>e>=95?["Excellent","status-good"]:e>=80?["OK","status-warn"]:["Bottleneck","status-bad"];

/* ================= PLANNER ================= */

const tbody=document.getElementById("planner");

function addRow(){
 const tr=document.createElement("tr");
 tr.innerHTML=`
<td><select class="item"><option></option>${Object.keys(recipes).map(i=>`<option>${i}</option>`).join("")}</select></td>
<td><select class="recipe"></select><div class="note"></div></td>
<td><input type="number" min="0"></td>
<td><select class="purity"><option>Impure</option><option selected>Normal</option><option>Pure</option></select></td>
<td><select class="minerMk">${minerMks.map(m=>`<option>${m.name}</option>`).join("")}</select></td>
<td><select class="minerCount">${[1,2,3,4,5,6].map(n=>`<option>${n}</option>`).join("")}</select></td>
<td><select class="inBelt">${belts.map(b=>`<option>${b.name}</option>`).join("")}</select></td>
<td class="machines">‚Äî</td>
<td class="power">‚Äî</td>
<td><select class="outBelt">${belts.map(b=>`<option>${b.name}</option>`).join("")}</select></td>
<td class="eff">‚Äî</td>
<td class="status status-wait">Waiting</td>
`;

 const item=tr.querySelector(".item");
 const recipeSel=tr.querySelector(".recipe");
 const note=tr.querySelector(".note");
 const input=tr.querySelector("input");
 const purity=tr.querySelector(".purity");
 const minerMkSel=tr.querySelector(".minerMk");
 const minerCountSel=tr.querySelector(".minerCount");
 const inBeltSel=tr.querySelector(".inBelt");
 const outBeltSel=tr.querySelector(".outBelt");

 function populateRecipes(){
  recipeSel.innerHTML=""; note.textContent="";
  if(!item.value) return;
  const list=recipes[item.value];
  const best=bestRecipe(list);
  list.forEach(r=>{
   const o=document.createElement("option");o.textContent=r.name;recipeSel.appendChild(o);
  });
  recipeSel.value=list[0].name;
  if(recipeSel.value!==best.name) note.textContent="Alt recipe available (better efficiency)";
 }

 function recalc(){
  if(!item.value||!input.value) return;

  const list=recipes[item.value];
  const recipe=list.find(r=>r.name===recipeSel.value);
  const best=bestRecipe(list);
  note.textContent=recipe.name===best.name?"":"Alt recipe available (better efficiency)";

  /* factory side */
  const machines=Math.ceil(input.value/recipe.rate);
  const totalOut=machines*recipe.rate;
  const power=machines*recipe.power;

  /* miner side */
  const purityBase=purityRates[purity.value];
  const minerMk=minerMks.find(m=>m.name===minerMkSel.value);
  const miners=Number(minerCountSel.value);
  const inputCap=purityBase*minerMk.mult*miners;

  /* belts */
  const reqInBelt=beltFor(inputCap);
  const reqOutBelt=beltFor(totalOut);

  /* auto defaults */
  minerMkSel.value=minerMkSel.value||minerMk.name;
  minerCountSel.value=miners;
  inBeltSel.value=inBeltSel.value||reqInBelt.name;
  outBeltSel.value=outBeltSel.value||reqOutBelt.name;

  /* validation */
  let status="Good",cls="status-good";
  if(inputCap<totalOut){status="Input Bottleneck";cls="status-bad";}
  else if(belts.find(b=>b.name===inBeltSel.value).cap<inputCap){status="Input Belt Bottleneck";cls="status-bad";}
  else if(belts.find(b=>b.name===outBeltSel.value).cap<totalOut){status="Output Belt Bottleneck";cls="status-bad";}

  const eff=Math.round((input.value/totalOut)*100);
  const [label]=effLabel(eff);

  tr.querySelector(".machines").textContent=machines;
  tr.querySelector(".power").textContent=power;
  tr.querySelector(".eff").textContent=`${eff}% ‚Äì ${label}`;
  const s=tr.querySelector(".status");s.textContent=status;s.className=`status ${cls}`;

  if(!tr.nextSibling) addRow();
 }

 tr.querySelectorAll("select,input").forEach(el=>el.addEventListener("change",recalc));
 tbody.appendChild(tr);
}

addRow();
</script>
</body>
</html>
