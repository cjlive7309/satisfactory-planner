<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Satisfactory Factory Planner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { margin:0; font-family:Arial,sans-serif; background:#0f172a; color:#e5e7eb; }
header { padding:1rem; background:#020617; font-size:1.25rem; font-weight:bold; }
table { width:100%; border-collapse:collapse; margin-top:1rem; }
th, td { padding:0.75rem; border-bottom:1px solid #1e293b; }
th { color:#94a3b8; }
select, input {
  background:#020617; color:#e5e7eb;
  border:1px solid #1e293b; border-radius:6px;
  padding:0.4rem; width:100%;
}
.status-good { color:#22c55e; }
.status-warn { color:#eab308; }
.status-bad { color:#ef4444; }
.status-wait { color:#64748b; }
.note { font-size:0.75rem; color:#eab308; }
</style>
</head>
<body>

<header>üè≠ Satisfactory Factory Planner</header>

<main style="padding:1rem;">
<table>
<thead>
<tr>
<th>Item</th>
<th>Recipe</th>
<th>Target / min</th>
<th>Machines</th>
<th>Power (MW)</th>
<th>Belt</th>
<th>Efficiency</th>
<th>Status</th>
</tr>
</thead>
<tbody id="planner"></tbody>
</table>
</main>

<script>
/* =====================
   BELTS
   ===================== */
const belts = [
  { name:"Mk1", max:60 },
  { name:"Mk2", max:120 },
  { name:"Mk3", max:270 },
  { name:"Mk4", max:480 },
  { name:"Mk5", max:780 }
];

/* =====================
   RECIPES (v1.4b)
   ===================== */
const recipes = {
  "Iron Plate": [
    { name:"Default", rate:20, machine:"Constructor", power:4 },
    { name:"Coated Iron Plate (Alt)", rate:37.5, machine:"Assembler", power:15 }
  ],
  "Iron Rod": [
    { name:"Default", rate:15, machine:"Constructor", power:4 },
    { name:"Steel Rod (Alt)", rate:48, machine:"Assembler", power:15 }
  ],
  "Screw": [
    { name:"Default", rate:40, machine:"Constructor", power:4 },
    { name:"Cast Screw (Alt)", rate:200, machine:"Constructor", power:4 }
  ],
  "Reinforced Iron Plate": [
    { name:"Default", rate:5, machine:"Assembler", power:15 },
    { name:"Bolted Iron Plate (Alt)", rate:15, machine:"Assembler", power:15 }
  ],
  "Modular Frame": [
    { name:"Default", rate:2, machine:"Assembler", power:15 }
  ],
  "Encased Industrial Beam": [
    { name:"Default", rate:6, machine:"Assembler", power:15 }
  ],
  "Rotor": [
    { name:"Default", rate:4, machine:"Assembler", power:15 }
  ],
  "Stator": [
    { name:"Default", rate:5, machine:"Assembler", power:15 }
  ],
  "Motor": [
    { name:"Default", rate:2, machine:"Assembler", power:15 }
  ],
  "Heavy Modular Frame": [
    { name:"Default", rate:0.5, machine:"Manufacturer", power:55 },
    { name:"Encased Frame (Alt)", rate:1, machine:"Manufacturer", power:55 }
  ],
  "Computer": [
    { name:"Default", rate:2.5, machine:"Manufacturer", power:55 }
  ]
};

/* =====================
   HELPERS
   ===================== */
function bestRecipe(list) {
  return list.reduce((a,b)=>b.rate>a.rate?b:a);
}

function beltFor(rate) {
  return belts.find(b=>rate<=b.max) || belts[belts.length-1];
}

function efficiencyLabel(e) {
  if (e >= 95) return ["Excellent","status-good"];
  if (e >= 80) return ["OK","status-warn"];
  return ["Bottleneck","status-bad"];
}

/* =====================
   PLANNER
   ===================== */
function addRow() {
  const tr = document.createElement("tr");

  tr.innerHTML = `
<td>
  <select class="item">
    <option value="">Select item</option>
    ${Object.keys(recipes).map(i=>`<option>${i}</option>`).join("")}
  </select>
</td>
<td>
  <select class="recipe"></select>
  <div class="note"></div>
</td>
<td><input type="number" min="0"></td>
<td class="machines">‚Äî</td>
<td class="power">‚Äî</td>
<td class="belt">‚Äî</td>
<td class="eff">‚Äî</td>
<td class="status status-wait">Waiting</td>
`;

  const itemSel = tr.querySelector(".item");
  const recipeSel = tr.querySelector(".recipe");
  const note = tr.querySelector(".note");
  const input = tr.querySelector("input");

  function populateRecipes() {
    recipeSel.innerHTML = "";
    note.textContent = "";
    if (!itemSel.value) return;

    const list = recipes[itemSel.value];
    const best = bestRecipe(list);

    list.forEach(r=>{
      const opt = document.createElement("option");
      opt.textContent = r.name;
      recipeSel.appendChild(opt);
    });

    recipeSel.value = list[0].name;

    if (recipeSel.value !== best.name) {
      note.textContent = "Alt recipe available (better efficiency)";
    }
  }

  function recalc() {
    const item = itemSel.value;
    const target = Number(input.value);
    if (!item || !target) return;

    const list = recipes[item];
    const recipe = list.find(r=>r.name===recipeSel.value);
    const best = bestRecipe(list);

    note.textContent =
      recipe.name === best.name ? "" : "Alt recipe available (better efficiency)";

    const machines = Math.ceil(target / recipe.rate);
    const totalRate = machines * recipe.rate;
    const power = machines * recipe.power;
    const eff = Math.round((target / totalRate) * 100);

    const belt = beltFor(totalRate);
    const [label, cls] = efficiencyLabel(eff);

    tr.querySelector(".machines").textContent = machines;
    tr.querySelector(".power").textContent = power;
    tr.querySelector(".belt").textContent = belt.name;
    tr.querySelector(".eff").textContent = eff + "% ‚Äì " + label;

    const status = tr.querySelector(".status");
    status.textContent = label;
    status.className = "status " + cls;

    if (tr.nextSibling === null) addRow();
  }

  itemSel.addEventListener("change", ()=>{ populateRecipes(); recalc(); });
  recipeSel.addEventListener("change", recalc);
  input.addEventListener("input", recalc);

  document.getElementById("planner").appendChild(tr);
}

addRow();
</script>
</body>
</html>
